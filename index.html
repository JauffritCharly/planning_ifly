<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planning Soufflerie</title>

  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">

  <!-- CSS personnalisé -->
  <link href="style.css" rel="stylesheet">

  <!-- FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/fr.js"></script>
</head>
<body>
  <div id="site-header" class="header">
    <div class="logo-container">
      <img src="logo.png" alt="Logo iFLY" class="logo">
    </div>

    <div class="contact-info">
      <strong>Jauffrit Charly</strong><br>
      <strong>Email :</strong>
      <a href="mailto:cjauffrit@iflyworld.com">cjauffrit&#64;iflyworld.com</a><br>
      <strong>Tél :</strong>
      <a href="tel:0643005183">0643005183</a>
    </div>
  </div>

  <div class="container mt-5">
    <div id="calendar"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const jsonUrl = 'planning.json?cache_buster=' + new Date().getTime();

      fetch(jsonUrl)
        .then(res => {
          if (!res.ok) {
            throw new Error('Erreur de chargement du planning : ' + res.status);
          }
          return res.json();
        })
        .then(planning => {
          const events = [];

          planning.forEach(day => {
            const date = day.date;
            const [year, month, dayNum] = date.split('-').map(Number);
            
            day.time_slots.forEach(time => {
              const [hour, minute] = time.split(':').map(Number);
              const start = new Date(year, month - 1, dayNum, hour, minute);
              const end = new Date(year, month - 1, dayNum, hour, minute + 30);

              const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
              
              const title = `${timeString} - ${new Date(end).toLocaleTimeString('fr-FR', {
                hour: '2-digit',
                minute: '2-digit'
              })}`;

              const backgroundColor = '#003366'; // Couleur par défaut
              const url = 'https://www.iflyfrance.com/bons-cadeaux/utiliser-un-bon-ifly/';

              events.push({
                title: title,
                start: start,
                end: end,
                color: backgroundColor,
                url: url
              });
            });
          });

          const calendarEl = document.getElementById('calendar');
          const calendar = new FullCalendar.Calendar(calendarEl, {
            locale: 'fr',
            initialView: 'timeGridWeek',
            allDaySlot: false,
            slotDuration: '00:30:00',
            minTime: '10:00:00',
            maxTime: '23:00:00',
            scrollTime: '10:00:00',
            timeZone: 'local',
            events: events,
            
            eventTimeFormat: {
              hour: '2-digit',
              minute: '2-digit',
              hour12: false
            },

            eventContent: function(arg) {
              return { html: arg.event.title };
            },

            eventClick: function(info) {
              if (info.event.url) {
                window.open(info.event.url, '_blank');
                info.jsEvent.preventDefault();
              }
            }
          });

          calendar.render();
        })
        .catch(err => console.error("Erreur chargement planning.json :", err));
    });
  </script>
</body>
</html>
